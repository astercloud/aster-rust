#!/bin/sh

# Rust ä»£ç æ ¼å¼åŒ–
if git diff --cached --name-only | grep -qE '\.rs$'; then
  echo "ğŸ¦€ Running cargo fmt..."
  cargo fmt
  
  # æ£€æŸ¥æ˜¯å¦æœ‰æ ¼å¼åŒ–çš„æ›´æ”¹
  if ! git diff --quiet; then
    echo "ğŸ“ cargo fmt å·²è‡ªåŠ¨ä¿®å¤æ ¼å¼é—®é¢˜ï¼Œæ­£åœ¨æ·»åŠ æ›´æ”¹..."
    git diff --cached --name-only | grep -E '\.rs$' | xargs git add
  fi
  
  # æœ€ç»ˆæ£€æŸ¥
  cargo fmt --check
  if [ $? -ne 0 ]; then
    echo "âŒ Rust ä»£ç æ ¼å¼æ£€æŸ¥å¤±è´¥"
    exit 1
  fi
  echo "âœ… Rust æ ¼å¼æ£€æŸ¥é€šè¿‡"
fi

# TypeScript/Desktop ä»£ç æ ¼å¼åŒ–
if git diff --cached --name-only | grep -q "^ui/desktop/"; then
  if [ -d "ui/desktop" ]; then
    echo "ğŸ“¦ Running lint-staged for desktop..."
    cd ui/desktop && npx lint-staged
  else
    echo "Warning: ui/desktop directory does not exist, skipping lint-staged"
  fi
fi
