#!/bin/sh

echo "ðŸ” Running pre-commit checks..."

# Rust æ£€æŸ¥
if git diff --cached --name-only | grep -qE '\.rs$'; then
  echo "ðŸ¦€ Checking Rust..."

  # Rust æ ¼å¼æ£€æŸ¥
  echo "  â†’ Rust format check..."
  cargo fmt --all -- --check
  if [ $? -ne 0 ]; then
    echo "âŒ Rust format check failed! Run 'cargo fmt' to fix."
    exit 1
  fi

  # Rust ç¼–è¯‘æ£€æŸ¥
  echo "  â†’ Rust build check..."
  cargo check --all-targets
  if [ $? -ne 0 ]; then
    echo "âŒ Rust build check failed!"
    exit 1
  fi

  echo "âœ… Rust checks passed"
fi

# TypeScript/Desktop æ£€æŸ¥
if git diff --cached --name-only | grep -q "^ui/desktop/"; then
  if [ -d "ui/desktop" ]; then
    echo "ðŸ“¦ Checking frontend (Electron)..."
    cd ui/desktop
    
    # TypeScript æ£€æŸ¥
    echo "  â†’ TypeScript check..."
    npx tsc --noEmit
    if [ $? -ne 0 ]; then
      echo "âŒ TypeScript check failed!"
      exit 1
    fi
    
    cd ../..
    echo "âœ… Frontend checks passed"
  fi
fi

# Tauri æ£€æŸ¥
if git diff --cached --name-only | grep -q "^ui/tauri/"; then
  if [ -d "ui/tauri" ]; then
    echo "ðŸ“¦ Checking frontend (Tauri)..."
    cd ui/tauri
    
    # TypeScript æ£€æŸ¥
    echo "  â†’ TypeScript check..."
    npx tsc --noEmit 2>/dev/null || true
    
    cd ../..
    echo "âœ… Tauri frontend checks passed"
  fi
fi

echo "âœ… All pre-commit checks passed!"
